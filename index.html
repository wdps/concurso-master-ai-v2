<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConcursoMaster AI - Simulados</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .card { background: white; border-radius: 15px; padding: 30px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .stats { display: flex; gap: 20px; margin-bottom: 30px; }
        .stat { flex: 1; text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .stat-number { font-size: 2rem; font-weight: bold; color: #667eea; }
        .materias-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .materia-card { background: #667eea; color: white; padding: 20px; border-radius: 10px; cursor: pointer; transition: transform 0.3s; text-align: center; }
        .materia-card:hover { transform: translateY(-5px); background: #5a6fd8; }
        
        /* SIMULADO */
        #simulado { display: none; }
        .questao-card { background: white; border-radius: 10px; padding: 25px; margin-bottom: 20px; }
        .alternativa { padding: 15px; margin: 10px 0; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .alternativa:hover { border-color: #667eea; background: #f8f9fa; }
        .alternativa.selecionada { background: #667eea; color: white; border-color: #667eea; }
        .alternativa.correta { background: #28a745; color: white; border-color: #28a745; }
        .alternativa.incorreta { background: #dc3545; color: white; border-color: #dc3545; }
        .btn { padding: 12px 25px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 10px; font-size: 1rem; }
        .btn:hover { background: #5a6fd8; }
        .btn-voltar { background: #6c757d; }
        .btn-voltar:hover { background: #5a6268; }
        .controles { display: flex; justify-content: space-between; margin-top: 20px; }
        .contador { color: #666; font-size: 0.9rem; }
        .resultado { text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- DASHBOARD -->
        <div id="dashboard">
            <div class="header">
                <h1>üéØ ConcursoMaster AI</h1>
                <p>Sistema Inteligente de Simulados para Concursos</p>
            </div>

            <div class="card">
                <div class="stats">
                    <div class="stat">
                        <div class="stat-number" id="totalQuestoes">0</div>
                        <div>Total de Quest√µes</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="totalMaterias">0</div>
                        <div>Mat√©rias Dispon√≠veis</div>
                    </div>
                </div>

                <h3 style="margin-bottom: 20px; text-align: center;">üìö Escolha uma Mat√©ria para Simular:</h3>
                <div class="materias-grid" id="materiasGrid">
                    <!-- Mat√©rias carregadas via JavaScript -->
                </div>
            </div>
        </div>

        <!-- SIMULADO -->
        <div id="simulado">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 id="questaoTitulo">Quest√£o 1</h3>
                    <button class="btn btn-voltar" onclick="voltarDashboard()">‚Üê Voltar ao In√≠cio</button>
                </div>

                <div class="questao-card">
                    <div id="questaoEnunciado" style="font-size: 1.1rem; line-height: 1.6; margin-bottom: 25px;">
                        Carregando quest√£o...
                    </div>

                    <div id="alternativas">
                        <!-- Alternativas carregadas via JavaScript -->
                    </div>

                    <div class="controles">
                        <div class="contador" id="contadorQuestao">Quest√£o 1 de 10</div>
                        <div>
                            <button class="btn" id="btnAnterior" onclick="questaoAnterior()" style="display: none;">‚Üê Anterior</button>
                            <button class="btn" id="btnProxima" onclick="proximaQuestao()">Pr√≥xima Quest√£o ‚Üí</button>
                            <button class="btn" id="btnVerificar" onclick="verificarResposta()" style="display: none; background: #28a745;">Verificar Resposta</button>
                        </div>
                    </div>
                </div>

                <div id="resultado" class="resultado" style="display: none;">
                    <!-- Resultado da resposta -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let questoes = [];
        let questaoAtual = 0;
        let materiaSelecionada = '';
        let respostaSelecionada = null;
        let respostasCorretas = 0;

        // Carregar dashboard
        async function carregarDashboard() {
            try {
                // Carregar dados do dashboard
                const [dashboardResponse, materiasResponse] = await Promise.all([
                    fetch('/api/dashboard-data'),
                    fetch('/api/materias')
                ]);

                const dashboardData = await dashboardResponse.json();
                const materiasData = await materiasResponse.json();

                // Atualizar estat√≠sticas
                document.getElementById('totalQuestoes').textContent = dashboardData.total_questoes;
                document.getElementById('totalMaterias').textContent = materiasData.materias.length;

                // Carregar mat√©rias
                let html = '';
                materiasData.materias.forEach(materia => {
                    const quantidade = dashboardData.questoes_por_materia[materia] || 0;
                    html += `
                        <div class="materia-card" onclick="iniciarSimulado('${materia}')">
                            <div style="font-size: 1.2rem; font-weight: bold;">${materia}</div>
                            <div>${quantidade} quest√µes dispon√≠veis</div>
                        </div>
                    `;
                });
                document.getElementById('materiasGrid').innerHTML = html;

            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
                document.getElementById('materiasGrid').innerHTML = '<p>Erro ao carregar mat√©rias. Tente recarregar a p√°gina.</p>';
            }
        }

        // Iniciar simulado
        async function iniciarSimulado(materia) {
            materiaSelecionada = materia;
            questaoAtual = 0;
            respostasCorretas = 0;
            
            try {
                // Carregar quest√µes da mat√©ria
                const response = await fetch(`/api/questoes/${encodeURIComponent(materia)}?limit=10`);
                const data = await response.json();
                
                if (data.questoes && data.questoes.length > 0) {
                    questoes = data.questoes;
                    
                    // Mostrar simulado
                    document.getElementById('dashboard').style.display = 'none';
                    document.getElementById('simulado').style.display = 'block';
                    
                    mostrarQuestao();
                } else {
                    alert(`Nenhuma quest√£o encontrada para ${materia}.`);
                }
            } catch (error) {
                console.error('Erro ao carregar quest√µes:', error);
                alert('Erro ao carregar quest√µes. Tente novamente.');
            }
        }

        // Mostrar quest√£o atual
        function mostrarQuestao() {
            if (questoes.length === 0) return;

            const questao = questoes[questaoAtual];
            respostaSelecionada = null;
            
            // Atualizar t√≠tulo e contador
            document.getElementById('questaoTitulo').textContent = `Quest√£o ${questaoAtual + 1} - ${materiaSelecionada}`;
            document.getElementById('contadorQuestao').textContent = `Quest√£o ${questaoAtual + 1} de ${questoes.length}`;
            
            // Atualizar enunciado
            document.getElementById('questaoEnunciado').textContent = questao.enunciado;
            
            // Criar alternativas
            let alternativasHTML = '';
            const alternativas = [
                { letra: 'A', texto: questao.alternativa_a },
                { letra: 'B', texto: questao.alternativa_b },
                { letra: 'C', texto: questao.alternativa_c },
                { letra: 'D', texto: questao.alternativa_d }
            ];

            alternativas.forEach(alt => {
                alternativasHTML += `
                    <div class="alternativa" onclick="selecionarAlternativa(this, '${alt.letra}')">
                        <strong>${alt.letra})</strong> ${alt.texto}
                    </div>
                `;
            });

            document.getElementById('alternativas').innerHTML = alternativasHTML;
            
            // Mostrar/ocultar bot√µes
            document.getElementById('btnAnterior').style.display = questaoAtual > 0 ? 'inline-block' : 'none';
            document.getElementById('btnProxima').style.display = questaoAtual < questoes.length - 1 ? 'inline-block' : 'none';
            document.getElementById('btnVerificar').style.display = 'inline-block';
            
            // Ocultar resultado
            document.getElementById('resultado').style.display = 'none';
            
            // Limpar sele√ß√µes
            document.querySelectorAll('.alternativa').forEach(alt => {
                alt.classList.remove('selecionada', 'correta', 'incorreta');
            });
        }

        // Selecionar alternativa
        function selecionarAlternativa(elemento, letra) {
            respostaSelecionada = letra;
            
            // Remover sele√ß√£o de todas
            document.querySelectorAll('.alternativa').forEach(alt => {
                alt.classList.remove('selecionada');
            });
            
            // Selecionar atual
            elemento.classList.add('selecionada');
        }

        // Verificar resposta
        function verificarResposta() {
            if (!respostaSelecionada) {
                alert('Selecione uma alternativa antes de verificar.');
                return;
            }

            const questao = questoes[questaoAtual];
            const correta = questao.resposta_correta;
            const acertou = respostaSelecionada === correta;
            
            if (acertou) {
                respostasCorretas++;
            }

            // Mostrar resultado
            const resultadoDiv = document.getElementById('resultado');
            resultadoDiv.innerHTML = `
                <h4>${acertou ? '‚úÖ Parab√©ns! Resposta Correta!' : '‚ùå Resposta Incorreta'}</h4>
                <p><strong>Sua resposta:</strong> ${respostaSelecionada}</p>
                <p><strong>Resposta correta:</strong> ${correta}</p>
                ${!acertou ? `<p><strong>Explica√ß√£o:</strong> A alternativa ${correta} √© a correta.</p>` : ''}
                <p><strong>Estat√≠stica:</strong> ${respostasCorretas} de ${questaoAtual + 1} quest√µes corretas</p>
            `;
            resultadoDiv.style.display = 'block';

            // Destacar alternativas
            document.querySelectorAll('.alternativa').forEach(alt => {
                const letra = alt.textContent.charAt(0);
                if (letra === correta) {
                    alt.classList.add('correta');
                } else if (letra === respostaSelecionada && !acertou) {
                    alt.classList.add('incorreta');
                }
            });

            // Desabilitar mais sele√ß√µes
            document.querySelectorAll('.alternativa').forEach(alt => {
                alt.style.pointerEvents = 'none';
            });
        }

        // Navega√ß√£o
        function questaoAnterior() {
            if (questaoAtual > 0) {
                questaoAtual--;
                mostrarQuestao();
            }
        }

        function proximaQuestao() {
            if (questaoAtual < questoes.length - 1) {
                questaoAtual++;
                mostrarQuestao();
            } else {
                // Fim do simulado
                const resultadoFinal = document.getElementById('resultado');
                resultadoFinal.innerHTML = `
                    <h3>üéâ Simulado Conclu√≠do!</h3>
                    <p><strong>Resultado Final:</strong> ${respostasCorretas} de ${questoes.length} quest√µes corretas</p>
                    <p><strong>Percentual de acerto:</strong> ${((respostasCorretas / questoes.length) * 100).toFixed(1)}%</p>
                    <button class="btn" onclick="voltarDashboard()">Voltar ao In√≠cio</button>
                    <button class="btn" onclick="reiniciarSimulado()">Fazer Outro Simulado</button>
                `;
                resultadoFinal.style.display = 'block';
            }
        }

        function reiniciarSimulado() {
            iniciarSimulado(materiaSelecionada);
        }

        function voltarDashboard() {
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('simulado').style.display = 'none';
            carregarDashboard(); // Recarregar estat√≠sticas
        }

        // Inicializar
        carregarDashboard();
    </script>
</body>
</html>
