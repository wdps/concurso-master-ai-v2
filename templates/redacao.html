<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redação - ConcursoMaster AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">ConcursoMaster AI</a>
        </div>
    </nav>
    
    <div class="container mt-4">
        <h2>Prática de Redação</h2>
        <div id="temas" class="mb-3">
            <div class="spinner-border"></div> Carregando temas...
        </div>
        <textarea id="texto-redacao" class="form-control" rows="10" placeholder="Selecione um tema para começar..." disabled></textarea>
        <button id="btn-corrigir" class="btn btn-primary mt-3" onclick="corrigirRedacao()" disabled>Corrigir Redação</button>
        
        <div id="resultado" class="mt-4" style="display: none;">
            <h4>Resultado:</h4>
            <div id="correcao"></div>
        </div>
    </div>

    <script>
        let temaSelecionado = null;
        
        // Carregar temas
        fetch('/api/redacao/temas')
            .then(r => r.json())
            .then(data => {
                if(data.success) {
                    const div = document.getElementById('temas');
                    div.innerHTML = '';
                    data.temas.forEach(tema => {
                        const btn = document.createElement('button');
                        btn.className = 'btn btn-outline-primary me-2 mb-2';
                        btn.textContent = tema.titulo;
                        btn.onclick = () => selecionarTema(tema);
                        div.appendChild(btn);
                    });
                }
            });
        
        function selecionarTema(tema) {
            temaSelecionado = tema;
            document.getElementById('texto-redacao').disabled = false;
            document.getElementById('btn-corrigir').disabled = false;
            document.getElementById('texto-redacao').placeholder = `Tema: ${tema.titulo}\n\n${tema.descricao}\n\nEscreva sua redação aqui...`;
        }
        
        function corrigirRedacao() {
            const texto = document.getElementById('texto-redacao').value;
            if(!texto) return alert('Escreva sua redação!');
            
            fetch('/api/redacao/corrigir', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({texto: texto, tema_id: temaSelecionado.id})
            })
            .then(r => r.json())
            .then(data => {
                if(data.success) {
                    const correcao = data.correcao;
                    document.getElementById('correcao').innerHTML = `
                        <div class="alert alert-info">
                            <h5>Nota: ${correcao.nota_final}/1000</h5>
                            <p>Palavras: ${correcao.estatisticas.palavras} | Parágrafos: ${correcao.estatisticas.paragrafos}</p>
                        </div>
                        <h6>Sugestões:</h6>
                        <ul>
                            ${correcao.sugestoes.map(s => `<li>${s}</li>`).join('')}
                        </ul>
                    `;
                    document.getElementById('resultado').style.display = 'block';
                }
            });
        }
    </script>
</body>
</html>
